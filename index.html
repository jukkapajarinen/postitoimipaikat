<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<title>Suomen postinumerot</title>
<link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
<link rel="manifest" href="favicons/site.webmanifest">
<link href="tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-white p-6">

<h1 class="text-3xl font-bold text-center">
  ✉️ Suomen postinumerot <span id="year"></span>
</h1>

<p class="text-center mt-6">Hae postinumeroa. Voit laittaa yhden tai useamman numeron:</p>
<div class="flex gap-4 justify-center mt-4">
  <input type="number" maxlength="1"
    class="w-16 h-20 text-3xl text-center font-bold rounded-xl border border-blue-400 bg-blue-200 focus:bg-blue-300 focus:outline-none" />
  <input type="number" maxlength="1"
    class="w-16 h-20 text-3xl text-center font-bold rounded-xl border border-green-400 bg-green-200 focus:bg-green-300 focus:outline-none" />
  <input type="number" maxlength="1"
    class="w-16 h-20 text-3xl text-center font-bold rounded-xl border border-yellow-400 bg-yellow-200 focus:bg-yellow-300 focus:outline-none" />
  <input type="number" maxlength="1"
    class="w-16 h-20 text-3xl text-center font-bold rounded-xl border border-pink-400 bg-pink-200 focus:bg-pink-300 focus:outline-none" />
  <input type="number" maxlength="1"
    class="w-16 h-20 text-3xl text-center font-bold rounded-xl border border-purple-400 bg-purple-200 focus:bg-purple-300 focus:outline-none" />
</div>

<p class="text-center mt-6">Tai hae postitoimipaikkaa:</p>
<div class="flex gap-4 justify-center mt-4">
  <input type="search" 
    class="h-10 text-xl text-center font-bold rounded-xl border border-gray-400 bg-gray-100 focus:bg-gray-200 focus:outline-none" />
</div>

<h2 class="text-center mt-16">Tulokset:</h2>
<div class="w-1/2 mx-auto rounded-md shadow-md overflow-hidden bg-gray-100 p-8 border border-gray-400 mt-4">
  <ol id="resultList"></ol>
</div>

<p class="text-sm flex justify-center mt-12">Haun toteutus: Jukka Pajarinen</p>
<p class="text-sm flex justify-center">
  <a class="text-blue-800 hover:underline" href="https://www.jukkapajarinen.com" target="_blank">www.jukkapajarinen.com</a>
  <span class="mx-2 text-gray-400">|</span>
  <a class="text-blue-800 hover:underline" href="https://www.lumitum.com" target="_blank">www.lumitum.com</a>
</p>

<script>
const prefix = "PONOT20260221";

const digitInputs = document.querySelectorAll('input[type="number"]');
const searchInput = document.querySelector('input[type="search"]');
const list = document.getElementById("resultList");

let postalData = []; // store all entries here

// Load file
fetch("PCF_20260221.dat")
.then(response => response.arrayBuffer())
.then(buffer => {
  const decoder = new TextDecoder("iso-8859-1");
  const text = decoder.decode(buffer);
  const lines = text.split(/\r?\n/);

  lines.forEach(line => {
    if (!line.startsWith(prefix)) return;

    const afterPrefix = line.substring(prefix.length);
    const value = afterPrefix.split(" ")[0];
    if (!value) return;

    const postalCode = value.substring(0, 5);
    const name = value.substring(5).trim();

    postalData.push({ postalCode, name });
  });

  renderList(postalData);
});

// Listen to digit inputs
digitInputs.forEach((input, index) => {
  input.addEventListener("input", (e) => {
    // Allow only one digit
    input.value = input.value.replace(/[^0-9]/g, "").slice(0, 1);

    if (input.value && index < digitInputs.length - 1) {
      digitInputs[index + 1].focus();
    }

    filterResults();
  });

  input.addEventListener("keydown", (e) => {
    // Go back on backspace if empty
    if (e.key === "Backspace" && !input.value && index > 0) {
      digitInputs[index - 1].focus();
    }
  });
});

// Listen to name search
searchInput.addEventListener("input", filterResults);

function filterResults() {
  const digitFilter = Array.from(digitInputs)
    .map(i => i.value)
    .join("");

  const nameFilter = searchInput.value.toLowerCase().trim();

  const filtered = postalData.filter(item => {
    const matchDigits = digitFilter
      ? item.postalCode.startsWith(digitFilter)
      : true;

    const matchName = nameFilter
      ? item.name.toLowerCase().includes(nameFilter)
      : true;

    return matchDigits && matchName;
  });

  renderList(filtered);
}

function renderList(data) {
  list.innerHTML = "";

  data.forEach(item => {
    const li = document.createElement("li");
    li.className = "text-3xl";

    const colors = [
      "text-blue-600",
      "text-green-600",
      "text-yellow-600",
      "text-pink-600",
      "text-purple-600"
    ];

    item.postalCode.split("").forEach((digit, index) => {
      const span = document.createElement("span");
      span.className = colors[index] + " font-bold";
      span.textContent = digit;
      li.appendChild(span);
    });

    const colon = document.createElement("span");
    colon.className = "text-black";
    colon.textContent = ":";
    li.appendChild(colon);

    const nameSpan = document.createElement("span");
    nameSpan.className = "ml-6 text-black";
    nameSpan.textContent = item.name;
    li.appendChild(nameSpan);

    list.appendChild(li);
  });
}
</script>

</body>
</html>
